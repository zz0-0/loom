好的，没有问题。以下为您的新标记语言规范起草的一份正式文档。

# Blox 规范 (v0.1)

## 1. 概述

Blox 是一种轻量级标记语言，旨在为现代文档编写提供强大、结构化且无歧义的表达能力。它融合了传统标记语言的简洁性，并引入了明确的区块类型、属性系统和嵌套模型，使其特别适合技术文档、学术论文、知识库和交互式内容。后缀.blox

## 2. 基本概念

### 2.1 区块 (Block)
区块是 Blox 文档的基本组成单位。每个区块由三部分组成：
1.  **类型 (Type)**： 一个字母数字字符串（可包含连字符 `-` 和下划线 `_`），标识区块的种类（如 `section`, `code`, `table`）。
2.  **属性 (Attributes)**： 零个或多个键值对，用于提供区块的元数据或配置选项。
3.  **内容 (Content)**： 区块所包含的文本数据。内容始终在区块定义行的后续行开始。

### 2.2 区块定义
区块由一行定义开始，格式如下：
```
{指示符}{类型} {属性}
```
*   **指示符 (Indicator)**： 一个或多个 `#` 字符，数量表示该区块的嵌套深度（层级）。
*   **类型 (Type)**： 标识区块种类。
*   **属性 (Attributes)**： 空格分隔的键值对列表，格式为 `key=value`。值如果包含空格或特殊字符（如 `=`, `#`, `{`, `}`, `"`, `'`），**必须**使用双引号 `"` 或单引号 `'` 括起来。简单值（仅含字母、数字、`-`, `_`, `.`）可省略引号。

**示例：**
```
#section title="引言" id=intro
##code lang=python runnable=true
###quote author="艾伦·凯"
```

### 2.3 嵌套与层级
`#` 的数量决定了区块的层级深度，并定义了父子关系。
*   `#` - 第一级 (根层级)
*   `##` - 第二级 (嵌套在第一级内)
*   `###` - 第三级 (嵌套在第二级内)
*   ... (以此类推)

## 3. 核心语法

### 3.1 常用区块类型

| 类型 | 描述 | 属性示例 |
| :--- | :--- | :--- |
| `section` | 文档章节 | `title="标题"`, `id=chap1` |
| `meta` | 文档元数据 | `author="张三"`, `version=1.2` |
| `document` | 文档定义 | `title="标题"`, `created=2023-07-01` |
| `code` | 代码块 | `lang=python`, `runnable=true` |
| `quote` | 引文区块 | `author="作者"`, `source="出处"` |
| `image` | 图片 | `src="a.png"`, `caption="说明"`, `width=80%` |
| `table` | 表格 | `caption="标题"`, `header=true` |
| `math` | 数学公式 | (无) |
| `list` | 列表 | `type=ordered|unordered|check` |
| `quiz` | 测验 | (无) |

### 3.2 简写与别名语法

#### 3.2.1 常用区块简写
为提高书写效率，Blox 支持以下简写形式：

| 简写 | 完整形式 | 说明 |
| :--- | :--- | :--- |
| `#h1`, `#h2`, `#h3`, `#h4`, `#h5`, `#h6` | `#section` | 标题级别（h1=一级，h2=二级，etc） |
| `#p` | `#paragraph` | 段落 |
| `#img` | `#image` | 图片 |
| `#tbl` | `#table` | 表格 |
| `#` | `#paragraph` | 无类型时默认为段落 |

**示例：**
```
#h1 "欢迎使用 Blox"
#h2 "子标题"
#p
这是一个段落。

#img src="logo.png" "公司标志"
```

#### 3.2.2 列表 (`#list`)
`#list` 区块支持两种内容编写方式：
1.  **标准区块式**：
    ```
    #list type=check
    ##item checked=true
    完成任务一
    ##item
    未完成任务二
    ```
2.  **简写标记式**（推荐）：
    在 `#list` 区块内，以连字符 `-` 开头的行被视为列表项。项的嵌套层级由行首的连字符数量决定。
    ```
    #list type=check
    - [x] 完成任务一
    - [ ] 未完成任务二
    -- 这是一个二级列表项（嵌套在上一个项内）
    ```
    如需为特定项添加属性，可使用内联语法：
    `- {{checked=true 完成任务一}}`

#### 3.2.3 其他简写语法

**引用简写：**
```
#q author="作者名"  // 等同于 #quote author="作者名"
引用内容
```

**代码简写：**
```
#c lang=python     // 等同于 #code lang=python
print("Hello")
```

**数学公式简写：**
```
#m                 // 等同于 #math
E = mc^2
```

**属性位置简写：**
当属性只有一个且为常用属性时，可以省略键名：
```
#h1 "标题文本"      // title属性可省略键名
#img "image.png"    // src属性可省略键名
#c python          // lang属性可省略键名
```

#### 3.2.4 表格 (`#table`)
`#table` 区块的内容默认为 CSV 格式（逗号分隔）。解析器应自动识别并解析。
```
#table caption="示例表格" header=true
姓名, 年龄, 职业
张三, 28, 工程师
李四, 32, 设计师
```
如需对特定单元格进行控制（如合并、样式），可使用 `{{cell}}` 内联语法：
```
#table
{{cell colspan=2 全标题}}, 另一个标题
内容1, 内容2, 内容3
```

### 3.3 内联语法 (Inline Syntax)
内联元素使用双花括号 `{{ }}` 定义，其语法与区块定义保持一致：`{{类型 属性 内容}}`。

*   **引用**：
    `{{@kay-quote}}` （简写）
    `{{ref id=kay-quote relation="supports"}}` （全写）

*   **变量插值**：
    `#var project=abc`
    `欢迎使用 {{!project_name}}！`

*   **样式与功能**：
    `{{bold 重要文本}}`
    `{{code lang=python "print('Hello')"}}`
    `{{link href="https://example.com" 示例链接}}`

### 3.4 注释
以双斜杠 `//` 开头的行是注释行，解析器应忽略整行。
```
// 这是一个注释，不会被解析
#section title=真实内容
```

### 3.5 转义
如果需要输出字面量的 `#`, `{{`, `}}`, `//`, `!`, `@` 等字符，需在其前使用反斜杠 `\` 进行转义。
```
这是一个字面量的 \# 号和一个字面的 \{\{ 符号。
```

## 4. 解析规则

1.  **区块起始**： 区块必须由定义行开始。**定义行后必须换行**，内容不能与定义写在同行。
2.  **属性解析**： 属性值无引号时，以空格或行尾结束。有引号时，引号内的内容需作为整体解析，并支持转义。
3.  **内容终止**： 一个区块的内容持续到文档结束，或遇到另一个**相同层级或更高层级**的区块定义行为止。在两个区块定义之间，如果出现没有以 # 开头的行，这些文本行被视为匿名段落，属于当前的父级区块。
4.  **错误处理**： 解析器遇到未知的区块类型或内联类型时，应将其作为普通段落或文本处理，而不应中断解析。这确保了文档的向前兼容性和鲁棒性。
5.  **嵌套一致性**： 子区块的层级（`#`数量）必须比父区块多一个。解析器不应纠正错误的嵌套。

## 5. 解析器优势

与 Markdown 相比，Blox 的解析规则更加简单明确：

### 5.1 Blox 解析优势
- **明确的区块边界**：每个区块有明确的开始标记，结束由层级决定
- **无歧义语法**：不存在上下文相关的语法规则
- **统一的属性系统**：所有区块使用相同的属性语法
- **简单的状态机**：解析器只需跟踪当前层级即可

### 5.2 Markdown 解析复杂性对比
- **上下文相关**：同样的符号在不同上下文有不同含义
- **空格敏感**：缩进规则复杂且不一致
- **嵌套歧义**：列表、引用等嵌套规则复杂
- **扩展冲突**：不同 Markdown 扩展之间可能冲突

## 附录 A: 完整示例

```
#meta author="AI" version="0.1"
#document title="Blox 示例"

#section title="欢迎"
这是一个段落。

#section title="代码演示"
##code lang=javascript runnable=true
function greet(name) {
  console.log(`Hello, ${name}!`);
}
greet("World");

#section title="引用与列表"
##quote author="Linvs Torvalds" id=linus-quote
“Talk is cheap. Show me the code.”

正如 {{@linus-quote}} 所说，我们需要：

#list type=unordered
- 少空谈
- 多写代码
-- 编写可运行的代码
-- 编写清晰的代码

#section title="表格"
##table header=true
编程语言, 难度, 喜爱度
Python, 低, 高
C++, 高, 中
Rust, 中, 高
```

---
*Blox Specification is licensed under CC-BY-4.0.*